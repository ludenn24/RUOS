<div id="wrapper-content">
    <div id="page-wrapper">
        <div class="main-content">
            <div class="content">
                <div class="section section-padding edu-ab">
                    <div class="container">
                        <div class="edu-ab">
                            <div class="group-title-index edu-ab-title">
                                <h2 class="center-title">
                                    PROCESO PARA <b>REGISTRO NUEVO</b> DE ORGANIZACION
                                </h2>
                                <h4 class="top-title">
                                    El siguiente paso es subir tus documentos para solicitud
                                </h4>
                            </div>
                            <div class="edu-ab-content">
                                <ul class="list-unstyled list-inline">
                                    <li>
                                        <div class="circle-icon fa-2x" style="background: #00a39c;"><i class="fa fa-check"
                                                                                                       style="color: white;"></i></div>
                                        <span>Crear cuenta</span>
                                    </li>
                                    <li>
                                        <div class="circle-icon fa-2x" style="background: #00a39c;"><i class="fa fa-check"
                                                                                                       style="color: white;"></i></div>
                                        <span>Iniciar sesión</span>
                                    </li>
                                    <li>
                                        <div class="circle-icon fa-2x" style="background: #00a39c;"><i class="fa fa-upload "
                                                                                                       style="color: white;"></i></div>
                                        <span>Subir documentos</span>
                                    <li>
                                        <div class="circle-icon fa-2x" style="background: #00a39c;"><i class="fa fa fa-envelope"
                                                                                                       style="color: white;"></i></div>
                                        <span>Enviar solicitud</span>
                                    </li>
                                    <li>
                                        <div class="circle-icon fa-2x"><i class="fa fa-search"></i></div>
                                        <span>Evaluación de documentos</span>
                                    </li>
                                    <li>
                                        <div class="circle-icon fa-2x"><i class="fa fa-thumbs-up"></i></div>
                                        <span>Estado de aprobación</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="load" class>
                </div>
                <div class="section nav-cancelar">
                    <div class="container">
                        <div class="nav-cancelar-wrapper">
                            <div class="nav-cancelar-left">
                                <p class="cancelar-text">¿Te <b class="focus">equivocaste</b> ?</p>
                                <p class="">Puedes cancelar la solicitud para seleccionar otro tipo.</p>
                            </div>
                            <div class="nav-cancelar-right">
                                <button class="btn btn-green btn-bold" data-target="#EliminarSolicitud" data-title="ELIMINAR SOLICITUD" data-toggle="modal" data-content="38"  id="datamodal" ><span>Cancelar solicitud</span></button>
                            </div>
                        </div>
                    </div>
                </div>
                <!--////////////////////////////////// TIPO DE MODIFICACIÓN/////////////////////////////////-->
                {% if SolicitudController.solicitud.inicio %}
                    <div class="section section-padding contact-main">
                        <div class="container">
                            <div class="group-title-index">
                                <h2 class="center-title">1. DATOS DEL REGISTRO NUEVO</h2>
                                <h4 class="top-title"><b>Ingrese los datos solicitados</b></h4>
                            </div>
                            <div class="contact-main-wrapper">
                                <form action="{{ base_url() }}/solicitud/updatefecha" class="bg-w-form contact-form" method="post" enctype="multipart/form-data">
                                    <div class="row">
                                        <div class="col-md-6{{ errors.inicio ? ' has-error' : '' }}">
                                            <label class="control-label form-label">INICIO DE VIGENCIA <span class="highlight">*</span></label>
                                            <input  type="date" class="form-control form-input" id="inicio" value="{{ SolicitudController.solicitud.inicio }}" name="inicio" >
                                        </div>
                                        <div class="col-md-6{{ errors.fin ? ' has-error' : '' }}">
                                            <label class="control-label form-label">FIN DE VIGENCIA <span class="highlight">*</span></label>
                                            <input  type="date" class="form-control form-input" id="fin" value="{{ SolicitudController.solicitud.fin }}" name="fin" >
                                        </div>
                                    </div>

                                    {% include 'templates/partials/flash.twig' %}

                                    <div class="contact-submit">
                                        <button type="submit" class="btn btn-green center btn-contact"><span>GUARDAR</span></button>
                                    </div>
                                    {{ csrf.field | raw }}
                                </form>
                            </div>
                        </div>
                    </div>

                    {% include 'auth/representantes.twig' %}

                {% else %}

                    <div class="section section-padding contact-main gray-color">
                        <div class="container">
                            <div class="group-title-index">
                                <h2 class="center-title">1. DATOS DEL REGISTRO NUEVO</h2>
                                <h4 class="top-title"><b>Ingrese los datos solicitados</b></h4>
                            </div>
                            <div class="contact-main-wrapper">
                                <form action="{{ base_url() }}/solicitud/updatefecha" class="bg-w-form contact-form" method="post" enctype="multipart/form-data">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="control-label form-label">INICIO DE VIGENCIA <span class="highlight">*</span></label>
                                            <input  type="date" class="form-control form-input" id="inicio" value="" name="inicio" >
                                        </div>
                                        <div class="col-md-6">
                                            <label class="control-label form-label">FIN DE VIGENCIA <span class="highlight">*</span></label>
                                            <input  type="date" class="form-control form-input" id="fin" value="" name="fin" >
                                        </div>
                                        {% include 'templates/partials/flash.twig' %}
                                    </div>
                                    <div class="contact-submit">
                                        <button type="submit" class="btn btn-green center btn-contact"><span>GUARDAR</span></button>
                                    </div>
                                    {{ csrf.field | raw }}
                                </form>
                            </div>
                        </div>
                    </div>
                {% endif %}
                <!--CARGA DE ARCHIVOS-->

                <!--////////////////////////////////// ENVIO DE SOLICITUD /////////////////////////////////-->

                {% if (JuntaDirectivaController.representantes | length > 0) %}
                    
                    {% if OrganizacionController.organizacion.tipo_den == 16 %}
                        {% include 'auth/uploads-juveniles.twig' %}
                    {% else %}
                        {% include 'auth/uploads-nuevo.twig' %}
                    {% endif  %}
                    
                    <script type="text/javascript">
                        $(window).on('load', function () {
                            $('#myModal').modal('show');
                        });
                    </script>

                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                    <h4 class="modal-title" id="myModalLabel">Usted debe completar los 3 pasos siguientes:</h4>
                                </div>
                                <div class="modal-body">
                                    <img src="{{ base_url() }}/images/guia_nuevo.jpg" width="100%">
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                {% endif  %}


            </div>
        </div>
                
        {% include 'templates/partials/modals.twig' %}

        <div class="modal fade" id="EliminarSolicitud" tabindex="-1" role="dialog" aria-labelledby="EliminarSolicitud">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header modalert">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true" style="color:#fff;">&times;</span></button>
                        <h4 class="modal-title modtitle"><strong>[ELIMINAR SOLICITUD]</strong></h4>
                    </div>
                    <div class="modal-body">
                        <div class="box-body row">
                            <div class="col-sm-12">
                                <div class="form-group">
                                    <label>Motivo: </label>
                                    <form name="eliminar_form" id="eliminar_form" method="post">
                                        <input type="hidden" name="codigo" id="codigo" value="{{ SolicitudController.solicitud.codigo}}">
                                        <input type="hidden" name="flag" id="flag" value="4">
                                        <textarea class="form-control obligateeliminar" id="comentario" data-content="Necesita ingresar un mensaje." rows="4" name="comentario"  placeholder="Escriba el mensaje"></textarea>
                                        {{ csrf.field | raw }}
                                    </form>
                                </div>
                                <div  class="msg"></div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
                        <button type="button" id="posteliminarsolicitud" data-loading-text="Guardando..."  class="btn btn-danger pull-left" autocomplete="off">Elminar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>

    function puestochange(sel) {
        if (sel.value == "43" || sel.value == "2") {
            $("#div-otros").show();
        } else {
            $("#div-otros").hide();
        }
    }

    function buscarDni() {
        var dni;
        var usuario;
        var pass;
        usuario = 'GPV01';
        pass = '$GPV.2019';
        dni = $("#dni").val();
        if (dni.length == 8) {
            BuscarPersonaDNI_WS_propietario('', dni, '', '', usuario, pass);
        } else {
            limpiar_propietario();
            bloquear_datosPropietario('0');
        }
    }


    function BuscarPersonaDNI_WS_propietario(key, dni, NROTAR, FECH, usuario, pass) {
        $.ajax({
            url: 'https://pide.munlima.gob.pe/CWS/BuscarDatosPersonalesPIDE',
            type: 'POST',
            data:
                    {
                        nuDniConsulta: dni,
                        usuario: usuario,
                        pass: pass

                    },
            beforeSend: function (e) {
                //$('#load').addClass('load');
            },
            success: function (data) {
                var c = JSON.parse(data);

                if (c.valor.return.coResultado = '0000') {
                    if (c.valor.return.datosPersona) {
                        bloquear_datosPropietario('1');
                        var a = c.valor.return.datosPersona;
                        var ubi = a.ubigeo.split("/");
                        $('#nombre').val(a.prenombres);
                        $('#apellido_pat').val(a.apPrimer);
                        $('#apellido_mat').val(a.apSegundo);
                        $('#direccion').val(a.direccion);
                        $('#departamento').val(ubi[0]);
                        $('#provincia').val(ubi[1]);
                        $('#distrito').val(ubi[2]);
                        $('#foto').val(a.foto);
                        document.getElementById("fecha_nacimiento").style.outline = "#fca700 solid 2px";
                        document.getElementById("sexo").style.outline = "#fca700 solid 2px";
                        var baseStr64 = a.foto;
                        imgElem.setAttribute('src', "data:image/jpg;base64," + baseStr64);
                    } else {
                        limpiar_propietario();
                        bloquear_datosPropietario('0');
                    }
                } else {
                    limpiar_propietario();
                    bloquear_datosPropietario('0');
                }
                $('#load').removeClass('load');
            },
            error: function (xhr, err) {
                $('#load').removeClass('load');
            }
        });
    }

    function limpiar_propietario() {
        $('#nombre').val('');
        $('#apellido_pat').val('');
        $('#apellido_mat').val('');
        $('#direccion').val('');
        $('#departamento').val('');
        $('#provincia').val('');
        $('#distrito').val('');
        $('#restriccion').val('');
    }


    function bloquear_datosPropietario(con) {
        if (con == '1') {
            $('#nombres').attr('disabled');
            $('#apellidopaterno').attr('disabled');
            $('#apellidomaterno').attr('disabled');
            $('#departamento').attr('disabled');
            $('#provincia').attr('disabled');
            $('#distrito').attr('disabled');
        } else {
            $('#nombres').removeAttr('disabled');
            $('#apellidopaterno').removeAttr('disabled');
            $('#apellidomaterno').removeAttr('disabled');
            $('#departamento').removeAttr('disabled');
            $('#provincia').removeAttr('disabled');
            $('#distrito').removeAttr('disabled');

        }
    }
</script>

<script>
    !function (a) {
        "use strict";
        a(function () {
            var b = a(window),
                    c = a(document.body),
                    content = '',
                    mycod = '',
                    operation = '',
                    form = '',
                    f = '',
                    mycodigo = '',
                    flag = '',
                    comentario = '',
                    codigo = '';

            a("#posteliminarsolicitud").on("click", function () {
                var b = a(this), dataString;
                var holder = '';
                var exito = true;
                $(".obligateeliminar").each(function () {
                    if ($(this).val() == '') {
                        $(this).focus();
                        holder = $(this).attr("data-content");
                        exito = false;
                        $(".msg").html("").show();
                        $(".msg").html("<div class='alert alert-danger'><i class='fa fa-exclamation-triangle'></i> " + holder + "</div>");
                        setTimeout(function () {
                            $(".msg").fadeOut(1500);
                        }, 1500);
                        return false;
                    }
                });
                if (!exito)
                    return false;
                dataString = $('#eliminar_form').serialize();
                $.ajax({
                    type: "POST",
                    url: "{{ base_url() }}/eliminarsolicitud",
                    data: dataString,
                    beforeSend: function () {
                        b.button("loading");
                    },
                    success: function (data) {
                        var position = data.indexOf('?');
                        var number = data.substr(0, position).replace(/\s+/g, '');
                        // alert(data + "=>" + position + " =>" + number + " =>"+number.length);
                        if (number > 0) {
                            b.button("reset");
                            $('#EliminarSolicitud').modal('hide')
                            $('#myModalInformation').find(".modal-body").html("<center>" + data.substr(position + 1, data.length) + "</center>");
                            $('#myModalInformation').modal('show');
                            ;
                            setTimeout(function () {
                                window.location.href = window.location;
                            }, 2000);

                        } else {
                            $(".msg").html("").show();
                            // $(".msg").html(data);
                            $(".msg").html("<div class='alert alert-danger'><i class='fa fa-exclamation-triangle'></i> " + holder + "</div>");
                            setTimeout(function () {
                                $(".msg").fadeOut(1500);
                            }, 1500);
                            b.button("reset");
                        }

                    },
                    error: function () {
                        console.log("It failed");
                    }
                })
            });
        })
    }

    (jQuery), function () {
        "use strict";
        $('#fono').keyup(function () {
            this.value = (this.value + '').replace(/[^0-9]/g, '');
        });
    }();
    $(document).ready(function () {
        $('#example').DataTable({
            "responsive": true,
            "scrollX": true,
            "language": {
                "lengthMenu": "Ver _MENU_ Registros por página",
                "zeroRecords": "No se encontraron resultados",
                "info": "Viendo página _PAGE_ de _PAGES_",
                "infoEmpty": "",
                "infoFiltered": "(filtrado de un total de _MAX_ registros)",
                "search": "Buscar:",
                "paginate": {
                    "first": "Primero",
                    "last": "Último",
                    "next": "Siguiente",
                    "previous": "Anterior"
                },
            },
            "order": [[0, "desc"]],
            columnDefs: [{
                    targets: [0, 1, 2, 3, 4],
                    orderData: [0, 1],
                    orderSequence: ["desc"],
                }, {
                    className: 'text-center',
                    targets: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
                }
            ]
        });
    });
</script>